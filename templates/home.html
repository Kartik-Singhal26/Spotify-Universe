<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home - Spotify Flask App</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* styles.css */
      body {
        background-color: #282828;
        color: #e1e1e1;
        font-family: "Arial", sans-serif;
        overflow-y: hidden;
      }

      .container {
        padding-top: 10px;
        width: 100%;
        margin: auto;
        padding-bottom: 5px;
      }

      .scrollable-container {
        max-height: 500px;
        overflow-y: auto;
        background-color: #181818;
        padding: 5px;
        border-radius: 5px;
        width: 100%; /* Same width as .container */
        margin: auto; /* Center the container */
        border: 1px solid #1b1d1b; /* Aesthetic border */
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); /* Optional: Add a shadow effect */
      }

      .scrollable-container::-webkit-scrollbar {
        width: 12px;
      }

      .scrollable-container::-webkit-scrollbar-track {
        background: #282828;
        border-radius: 10px;
      }

      .scrollable-container::-webkit-scrollbar-thumb {
        background-color: #1db954;
        border-radius: 10px;
        border: 3px solid #282828;
      }

      .card,
      .list-group-item {
        background-color: #202020;
        border: 1px solid #343434;
        margin-bottom: 10px;
      }

      .list-group-item {
        cursor: pointer;
        color: #ffffff;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .list-group-item:hover,
      .list-group-item:focus {
        background-color: #76a587;
        color: #ffffff;
      }

      h1,
      h2 {
        color: #ffffff;
      }

      a,
      .list-group-item:hover a,
      .list-group-item:focus a {
        color: #76a587;
        text-decoration: none;
      }

      a:hover {
        color: #ffffff;
      }

      p,
      small,
      .track-time {
        color: #b3b3b3;
      }

      .track-info {
        display: flex;
        align-items: center;
      }

      .track-image {
        margin-right: 15px;
        width: 50px;
        height: 50px;
        object-fit: cover;
      }

      .track-time {
        min-width: 50px;
        text-align: right;
      }

      .carousel-caption {
        display: none; /* Hide by default */
      }

      .carousel-item:hover .carousel-caption {
        display: block; /* Show on hover */
      }

      hr.spotify-green {
        border: 0;
        height: 1px;
        background-color: #1db954;
        margin: 20px 0;
      }

      /* Adjusting carousel height and icons */
      .carousel-item {
        height: 200px;
        overflow: hidden;
      }

      .carousel-item img {
        width: auto;
        height: 80%;
        margin: 0 auto;
        opacity: 0.5;
        transition: opacity 0.3s ease;
      }

      .carousel-item:hover img {
        opacity: 1;
      }

      /* CSS Styles */
      /* Adjusting playlist items */
      .playlist-item {
        position: relative; /* Set position to relative */
        bottom: 0%; /* Align playlist items to the bottom of carousel item */
        left: 50%; /* Center playlist item horizontally */
        transform: translateX(-50%); /* Adjust for centering */
        transition: border-color 0.3s ease; /* Smooth transition for border color change */
        cursor: pointer; /* Change cursor to pointer on hover */
        border-radius: 2px; /* Add border radius */
      }

      /* Add green border to selected playlist */
      .playlist-item.selected {
        border: 2px solid #1db954; /* Green border */
      }

      /* Adjusting carousel arrows */
      .carousel-control-prev,
      .carousel-control-next {
        top: 50%; /* Center the arrows vertically */
        width: 20px; /* Adjust the width of arrows */
        height: 40px; /* Adjust the height of arrows */
        background-color: rgba(
          0,
          0,
          0,
          0.5
        ); /* Add background color to arrows */
        margin-top: -20px; /* Offset to center vertically */
      }

      .carousel-control-prev-icon,
      .carousel-control-next-icon {
        background-color: transparent; /* Remove background color of arrow icons */
        color: white; /* Set color of arrow icons */
        width: 50px; /* Adjust the width of arrow icons */
        height: 50px; /* Adjust the height of arrow icons */
      }

      .carousel-control-prev-icon {
        margin-right: 5px; /* Adjust the margin to separate icons from arrows */
      }

      .carousel-control-next-icon {
        margin-left: 5px; /* Adjust the margin to separate icons from arrows */
      }
      .selected-playlist {
        border: 1px solid #1db954 !important; /* Override to indicate selection */
        box-shadow: 0 0 15px #1db954;
      }

      /* Minimize vertical space for playlist details */
      #playlistDetails {
        padding: 10px 0;
      }

      /* Align "Your Music Universe" and stats in the same line */
      .user-info-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .user-stats {
        display: flex;
        gap: 15px;
      }

      .user-stats p {
        margin-bottom: 0; /* Remove margin-bottom to save space */
      }
      .row.fixed-container {
            display: flex;
            flex-wrap: nowrap;
            height: calc(100vh - 80px); /* Adjust based on your header/footer height */
            overflow: hidden;
        }

        #playlistDetails {
            flex: 0 0 300px; /* Adjust width of the sidebar */
            height: 100%;
            overflow-y: auto; /* Enable scrolling for sidebar */
            position: sticky;
            top: 80px; /* Adjust based on your header height */
            padding: 15px;
            background-color: #282828;
            border-right: 2px solid rgba(255, 255, 255, 0.1);
        }

        #tracksContainer {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            height: 100%;
        }

        /* Scrollbar customization */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0e0e0e;
        }

        ::-webkit-scrollbar-thumb {
            background: #1db954;
            border-radius: 4px;
        }

        /* Adjust for smaller screens */
        @media (max-width: 768px) {
            .row.fixed-container {
                flex-wrap: wrap;
                height: auto;
            }

            #playlistDetails {
                position: relative;
                top: 0;
                height: auto;
                flex: 0 0 100%;
            }

            #tracksContainer {
                flex: 0 0 100%;
            }
        }

    </style>
  </head>
  <body>
    <div class="container mt-3">
        <div class="row">
            <!-- User Info and Stats Row -->
            <div class="col-md-12 mb-2">
                <div
                    class="bg-dark text-light py-3 px-4 rounded"
                    style="background-color: #1db954; position: relative;"
                >
                    <div class="user-info-header d-flex justify-content-between align-items-end">
                        <div>
                            <h1 class="h4 mb-1" style="color: #ffffff;">
                                Welcome, {{ user_info.get('display_name', 'User') }}!
                            </h1>
                            <p class="lead my-2" style="color: #191414; font-size: 1rem;">
                                To Your Music Universe
                            </p>
                        </div>
                        <div>
                            <a href="/logout" class="btn btn-dark" style="background-color: #191414; border-color: #333;">Logout</a>
                        </div>
                    </div>
                    <div class="user-stats text-light d-flex justify-content-start">
                        <p><i class="fas fa-play-circle"></i> <strong>{{ user_stats['num_playlists'] }}</strong> public playlists</p>
                        <p><i class="fas fa-music"></i> <strong>{{ user_stats['num_unique_tracks'] }}</strong> unique tracks</p>
                        <p><i class="fas fa-user-friends"></i> <strong>{{ user_stats['num_unique_artists'] }}</strong> artists</p>
                    </div>
                </div>
            </div>
        </div>
      <!-- Playlist Carousels -->
      <div class="row">
        <div class="col-lg-12">
          <div
            id="carouselExampleControls"
            class="carousel slide"
            data-ride="carousel"
            data-interval="false"
          >
            <div class="carousel-inner" id="playlistsContainer">
              <!-- Playlists will be loaded dynamically here -->
            </div>
            <a
              class="carousel-control-prev"
              href="#carouselExampleControls"
              role="button"
              data-slide="prev"
            >
              <span
                class="carousel-control-prev-icon"
                aria-hidden="true"
              ></span>
              <span class="sr-only">Previous</span>
            </a>
            <a
              class="carousel-control-next"
              href="#carouselExampleControls"
              role="button"
              data-slide="next"
            >
              <span
                class="carousel-control-next-icon"
                aria-hidden="true"
              ></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
        </div>
      </div>

      <div class="row mt-3">
        <div id="playlistDetails" class="col-md-4 mb-4" style = "padding: 5px;">
            <!-- Playlist details will be dynamically filled here -->
        </div>
        <div id="tracksContainer" class="col-md-8 scrollable-container" style="padding: 10px;">
            <!-- Tracks will be shown here when a playlist is selected -->
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script>
      $(document).ready(function () {
        // Function to display a random music note or playlist name
        function displayRandomMusicNoteOrPlaylistName(playlistName) {
          if (playlistName) {
            // If playlist name is provided, display it in the tracks container
            $("#tracksContainer").html(
              `<p>loading data for ${playlistName}<p><div class="text-center mt-5"><p class="mt-3">do bi do bi do baa</p></div>`
            );
          } else {
            // If playlist name is not provided, display a random music note
            var musicNotes = [
              "🎸",
              "🎻",
              "🎷",
              "🎺",
              "🎹",
              "🥁",
              "🎵",
              "🎶",
              "♪",
              "♫",
              "♬",
              "🎼",
              "🎧",
              "🎤",
              "📻",
              "🎫",
              "💿",
              "📀",
              "🔌",
            ];
            var randomIndex = Math.floor(Math.random() * musicNotes.length);
            var randomNote = musicNotes[randomIndex];
            $("#tracksContainer").html(
              `<div class="text-center mt-5"><span style="font-size: 100px;">${randomNote}</span><p class="mt-3">Select a playlist to see tracks</p></div>`
            );
          }
        }
        // Initially display a random music note
        displayRandomMusicNoteOrPlaylistName();

        // Handle playlist item click event
        $("#playlistsContainer").on("click", ".playlist-item", function () {
          var playlistName = $(this).data("playlist-name");
          displayRandomMusicNoteOrPlaylistName(playlistName);
        });

        // AJAX request to fetch playlists
        $.ajax({
          url: "http://127.0.0.1:5000/get-playlists",
          type: "GET",
          dataType: "json",
          success: function (playlists) {
            var playlistsHtml = ""; // Initialize playlists HTML
            var carouselItem;
            var carouselItemCounter = 0; // Counter for carousel items
            playlists.forEach(function (playlist, index) {
              if (carouselItemCounter % 6 === 0) {
                // Start new carousel item for every 5 playlists
                var isActive = carouselItemCounter === 0 ? "active" : ""; // Set the first item as active
                playlistsHtml += `
                      <div class="carousel-item ${isActive}">
                          <div class="row">`;
              }

              // Add playlist item to the current carousel item
              playlistsHtml += `
                  <div class="col-lg-2 col-md-6 col-sm-6 mb-4">
                      <div class="playlist-item" data-playlist-id="${playlist.id}" data-playlist-name="${playlist.name}">
                          <img src="${playlist.image_url}" class="img-fluid" alt="${playlist.name}">
                          <div class="carousel-caption d-none d-md-block">
                          </div>
                      </div>
                  </div>
              `;

              carouselItemCounter++; // Increment carousel item counter

              if (
                carouselItemCounter % 6 === 0 ||
                index === playlists.length - 1
              ) {
                // End carousel item when reaching 5 playlists or end of playlists
                playlistsHtml += `
                          </div>
                      </div>
                  `;
              }
            });

            $("#playlistsContainer").html(playlistsHtml); // Append the playlists to the container
          },
          error: function () {
            console.error("Error fetching playlists.");
          },
        });

        // Handle playlist item click event
        // Handle playlist item click event
        $("#playlistsContainer").on("click", ".playlist-item", function () {
          var playlistId = $(this).data("playlist-id");
          var playlistName = $(this).data("playlist-name");

          // AJAX request to fetch playlist details
          $.ajax({
            url: `http://127.0.0.1:5000/get-playlist-details/${playlistId}`,
            type: "GET",
            dataType: "json",
            success: function (playlistDetails) {
              var playlistDetailsHtml = `
                    <h2>${playlistName}</h2>
                    <p>${playlistDetails.description}</p>
                    <p><strong>Owner:</strong> ${playlistDetails.owner}</p>
                    <p><strong>Total Tracks:</strong> ${playlistDetails.total_tracks}</p>
                    <!-- You can add more details here as needed -->
                `;
              $("#playlistDetails").html(playlistDetailsHtml);
            },
            error: function () {
              console.error("Error fetching playlist details.");
              $("#playlistDetails").html(
                "<p>Error loading playlist details.</p>"
              );
            },
          });

          // AJAX request to fetch tracks for the selected playlist
          $.ajax({
            url: `http://127.0.0.1:5000/get-tracks/${playlistId}`,
            type: "GET",
            dataType: "json",
            success: function (tracks) {
              var tracksHtml = `<div class="list-group">`;
              tracks.forEach(function (track) {
                var trackDuration = new Date(track.duration_ms)
                  .toISOString()
                  .substr(14, 5); // Convert duration to MM:SS format
                tracksHtml += `
                <a href="${track.spotify_url}" target="_blank" class="list-group-item list-group-item-action">
                <div class="d-flex justify-content-between align-items-center w-100">
                    <div class="track-info d-flex align-items-center">
                        <img src="${track.image_url}" alt="${track.name}" class="img-fluid mr-3" style="width: 50px; height: 50px; object-fit: cover;">
                        <div>
                            <h5 class="mb-1 text-truncate" style="max-width: 300px;">${track.name}</h5>
                            <p class="mb-1" style="font-size: 14px;">${track.artist}</p>
                        </div>
                    </div>
                    <div class="ml-4 text-right">
                        <small class="track-time" style="font-size: 12px;">${trackDuration}</small>
                    </div>
                </div>
            </a>

            `;
              });
              tracksHtml += "</div>";
              $("#tracksContainer").html(tracksHtml); // Display tracks in the tracks container
            },
            error: function () {
              console.error("Error fetching tracks.");
              $("#tracksContainer").html(
                `<div class="list-group"><p>Error loading tracks.</p></div>`
              );
            },
          });
        });

        // Move carousel to the previous item
        $(".carousel-control-prev").on("click", function () {
          $("#carouselExampleControls").carousel("prev");
        });

        // Move carousel to the next item
        $(".carousel-control-next").on("click", function () {
          $("#carouselExampleControls").carousel("next");
        });

        $("#playlistsContainer").on("click", ".playlist-item", function () {
          $(".playlist-item").removeClass("selected-playlist"); // Remove highlight from all
          $(this).addClass("selected-playlist"); // Highlight selected playlist
          // Continue with existing AJAX requests for playlist details and tracks
        });
      });
    </script>
  </body>
</html>
